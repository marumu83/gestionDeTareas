version: '4'
services:
  api-gateway:
    container_name: api-gateway
    build: ./api-gateway
    image: api-gateway
    ports:
      - 8080:8080
    networks:
      - dockernetwork

  discovery-server:
    container_name: discovery-server
    build: ./discovery-server
    image: discovery-server
    restart: always
    ports:
      - 8761:8761
    depends_on:
      - basedatos
    networks:
      - dockernetwork
    environment:
      eureka.instance.hostname: discovery-server
      eureka.client.serviceUrl.defaultZone: http://discovery-server:8761/eureka

  basedatos:
    container_name: basedatos
    image: mysql:5
    restart: always
    environment:
      - MYSQL_DATABASE=tareasdb
      - MYSQL_ROOT_PASSWORD=12345
      - PMA_HOST=mysql
    ports:
      - 3307:3306
    networks:
      - dockernetwork

  usuarios-service:
    container_name: usuarios-service
    build: ./usuarios-service
    image: usuarios-service
    ports:
      - 8050:8050
    depends_on:
      - api-gateway
    networks:
      - dockernetwork
    environment:
      - SPRING_PROFILES_ACTIVE=docker
      - DATABASE_URL=jdbc:mysql://basedatos:3306/tareasdb?autoReconnect=true&useSSL=false
      - DATABASE_USERNAME=root
      - DATABASE_PASSWORD=12345

networks:
  dockernetwork:
    driver: bridge
